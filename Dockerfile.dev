FROM node:12-alpine

ARG GEELBE_API_CLIENT_ID
ARG GEELBE_API_CLIENT_SECRET
ARG GEELBE_API_SCOPE
ARG GEELBE_API_HOST
ARG GEELBE_FACEBOOK_API_ID
ARG GEELBE_API_CLIENT_SECRET
ARG GEELBE_API_PROTOCOL
ARG URI_PREFIX
ARG S3_FOLDER
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG PUBLIC_PATH

ENV AWSCLI_VERSION "1.14.10"

ENV HOST=0.0.0.0
ENV PORT=3000
ENV GEELBE_API_CLIENT_ID=$GEELBE_API_CLIENT_ID
ENV GEELBE_API_CLIENT_SECRET=$GEELBE_API_CLIENT_SECRET
ENV GEELBE_API_SCOPE=$GEELBE_API_SCOPE
ENV GEELBE_API_HOST=$GEELBE_API_HOST
ENV GEELBE_FACEBOOK_API_ID=$GEELBE_FACEBOOK_API_ID
ENV GEELBE_API_CLIENT_SECRET=$GEELBE_API_CLIENT_SECRET
ENV GEELBE_API_PROTOCOL=$GEELBE_API_PROTOCOL
ENV URI_PREFIX=$URI_PREFIX
ENV PUBLIC_PATH=$PUBLIC_PATH

RUN apk add --update \
  python \
  python-dev \
  py-pip \
  build-base \
  && pip install awscli==$AWSCLI_VERSION --upgrade --user \
  && apk --purge -v del py-pip \
  && rm -rf /var/cache/apk/*

RUN mkdir -p /usr/src/geelbe
WORKDIR /usr/src/geelbe

RUN apk update && apk upgrade
RUN apk add git

COPY package*.json ./
RUN npm install -D

COPY . .

EXPOSE 3000

RUN  apk del --purge \
  *-dev \
  python


CMD [ "npm", "run", "dev" ]
